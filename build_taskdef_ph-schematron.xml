<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  Copyright 2017, 2018 DOCTALES. All rights reserved.
  See the accompanying LICENSE file for applicable license.
-->
<project>
    <path id="ph-schematron.path">
        <pathelement location="lib/istack-commons-runtime-2.21.jar"/>
        <pathelement location="lib/jaxb-core-2.2.11.jar"/>
        <pathelement location="lib/jaxb-runtime-2.2.11.jar"/>
        <pathelement location="lib/ph-collection-9.1.5.jar"/>
        <pathelement location="lib/ph-commons-9.1.5.jar"/>
        <pathelement location="lib/ph-isorelax-1.1.1.jar"/>
        <pathelement location="lib/ph-jaxb-9.1.5.jar"/>
        <pathelement location="lib/ph-schematron-5.0.6.jar"/>
        <pathelement location="lib/ph-schematron-ant-task-5.0.6.jar"/>
        <pathelement location="lib/ph-xml-9.1.5.jar"/>        
    </path>
    
    <!-- Task definition of ph-schematron task -->
    <taskdef name="schematron"
        classname="com.helger.schematron.ant.Schematron"
        classpathref="ph-schematron.path"
    />
    
    <!-- JavaScript task to iterate over comma separated list of files -->
    <scriptdef name="schematron-validate" language="javascript">
        <attribute name="target"/>
        <attribute name="files"/>
        <![CDATA[
            var sch = attributes.get("files").split(",");
            sch.forEach(function(s) {
                self.log("Schematron File ist " + s);
                var task = project.createTask("antcall");
                task.setTarget(attributes.get("target"));
                var param = task.createParam();
                param.setName("schematron.files");
                param.setValue(s);
                task.perform();
            });
        ]]>
    </scriptdef>
</project>