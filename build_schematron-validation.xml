<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  Copyright 2017, 2018 DOCTALES. All rights reserved.
  See the accompanying LICENSE file for applicable license.
-->
<project basedir="." name="build_dita2schematron" xmlns:if="ant:if" xmlns:unless="ant:unless">
    
    <import file="build_taskdef_ph-schematron.xml"/>
    
    <target name="schematron-validation">
        <property name="schematron.processing.engine" value="schematron"/>
        <schematron-validate if:set="schematron.map.validation.files"
            target="-schematron-validate-maps"
            files="${schematron.map.validation.files}"
        />
        <schematron-validate if:set="schematron.topic.validation.files"
            target="-schematron-validate-topics"
            files="${schematron.topic.validation.files}"
        />
    </target>
    
    <target name="-schematron-validate-maps">
        <echo level="info">Validate '@{map.file}' with '${schematron.files}' using the processing engine '${schematron.processing.engine}'</echo>
        <schematron
            schematronFile="${schematron.files}"
            expectSuccess="true"
            schematronProcessingEngine="${schematron.processing.engine}"
            failOnError="true">
            <xmlcatalog refid="dita.catalog" />
            <ditafileset format="ditamap" />
            <!-- FIXME Publication fails. It does not matter, whether the failOnError.error property is set or not -->
            <errorRole if:set="failOnError.fatal" role="fatal" />
            <errorRole if:set="failOnError.error" role="error" />
            <errorRole if:set="failOnError.warning" role="warning" />
            <errorRole if:set="failOnError.info" role="info" />
        </schematron>
    </target>
    
    <target name="-schematron-validate-topics">
        <echo level="info">Validate topics with '${schematron.files}' using the processing engine '${schematron.processing.engine}'</echo>
        <schematron
            schematronFile="${schematron.files}"
            expectSuccess="true"
            schematronProcessingEngine="${schematron.processing.engine}"
            failOnError="true">
            <xmlcatalog refid="dita.catalog" />
            <ditafileset format="dita" />
            <errorRole if:set="failOnError.fatal" role="fatal" />
            <errorRole if:set="failOnError.error" role="error" />
            <errorRole if:set="failOnError.warning" role="warning" />
            <errorRole if:set="failOnError.info" role="info" />
        </schematron>
    </target>
    
</project>
