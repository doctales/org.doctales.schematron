<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  Copyright 2017, 2018 DOCTALES. All rights reserved.
  See the accompanying LICENSE file for applicable license.
-->
<project basedir="." name="build_dita2schematron" xmlns:if="ant:if" xmlns:unless="ant:unless">
    
    <import file="build_taskdef_ph-schematron.xml"/>
    
    <!-- Default failing rules -->
    <property name="schematron.fail" value="true" />
    <property name="schematron.failon.fatal" value="true" />
    <property name="schematron.failon.error" value="true" />
    <property name="schematron.failon.warning" value="false" />
    <property name="schematron.failon.info" value="false" />
    <property name="svrlDirectory" value="${output.dir}" />
    
    <target name="schematron-validation">
        <property name="schematron.processing.engine" value="pure"/>
        <schematron-validate if:set="schematron.map.validation.files"
            target="-schematron-validate-maps"
            files="${schematron.map.validation.files}"
        />
        <echo unless:set="schematron.map.validation.files" level="info">Skip Schematron DITA Map validation</echo>
        <schematron-validate if:set="schematron.topic.validation.files"
            target="-schematron-validate-topics"
            files="${schematron.topic.validation.files}"
        />
        <echo unless:set="schematron.topic.validation.files" level="info">Skip Schematron DITA Topic validation</echo>
    </target>
    
    <target name="-schematron-validate-maps">
        <echo level="info">Validate '@{map.file}' with '${schematron.files}' using the processing engine '${schematron.processing.engine}'</echo>
        <schematron
            schematronFile="${schematron.files}"
            expectSuccess="true"
            svrlDirectory="${svrlDirectory}"
            schematronProcessingEngine="${schematron.processing.engine}"
            failOnError="${schematron.fail}">
            <xmlcatalog refid="dita.catalog" />
            <ditafileset format="ditamap" />
            <errorRole if:true="schematron.failon.fatal" role="fatal" />
            <errorRole if:true="schematron.failon.error" role="error" />
            <errorRole if:true="schematron.failon.warning" role="warning" />
            <errorRole if:true="schematron.failon.info" role="info" />
        </schematron>
    </target>
    
    <target name="-schematron-validate-topics">
        <echo level="info">Validate topics with '${schematron.files}' using the processing engine '${schematron.processing.engine}'</echo>
        <schematron
            schematronFile="${schematron.files}"
            expectSuccess="true"
            svrlDirectory="${svrlDirectory}"
            schematronProcessingEngine="${schematron.processing.engine}"
            failOnError="${schematron.fail}">
            <xmlcatalog refid="dita.catalog" />
            <ditafileset format="dita" />
            <errorRole if:true="schematron.failon.fatal" role="fatal" />
            <errorRole if:true="schematron.failon.error" role="error" />
            <errorRole if:true="schematron.failon.warning" role="warning" />
            <errorRole if:true="schematron.failon.info" role="info" />
        </schematron>
    </target>
    
</project>
